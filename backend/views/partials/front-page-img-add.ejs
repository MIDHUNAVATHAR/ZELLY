
<!--logo -->

<div class=" w-full bg-white p-6 rounded-lg shadow-lg">
    <h1 class="text-2xl font-bold mb-4">Upload Logo</h1>
    <form action="/admin/uploadLogo" method="post" enctype="multipart/form-data" class="mb-4" id="uploadForm">
      <div class="mb-4">
        <label for="logo" class="block text-sm font-medium text-gray-700 mb-2">Choose File</label>
        <input type="file" name="logo" id="logo" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" required>
      </div>
      <!-- cropping contiainer -->
      <div id="cropperContainer" style="display: none; max-width: 500px; margin-bottom: 20px;"> 
        <img id="image" src="" alt="Image for cropping" style="max-width: 100%;"> 
      </div>
      <!--cropping container-->
      <button type="button" id="cropButton" style="display: none;" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700">Crop & Upload</button>
    </form>
    <h2 class="text-xl font-bold mb-4">Uploaded Logos</h2>
    <div class="grid grid-cols-10 gap-4">
      <% if (logo && logo.length > 0) { %>  
        <% logo.forEach(l => { %>
          <div>
            <img src="<%= l.image.data %>" alt="Logo"> 
          </div>
        <% }) %>
      <% } else { %>
        <p>No logo available</p>
      <% } %> 
    </div>
</div>

<!--banner images-->
<div class=" w-full bg-white p-6 rounded-lg shadow-lg">
  <h1 class="text-2xl font-bold mb-4">Upload Banner Images</h1>
  <form action="/admin/uploadBanner" method="post" enctype="multipart/form-data" class="mb-4" id="uploadForm2">
    <div class="mb-4">
      <label for="banner" class="block text-sm font-medium text-gray-700 mb-2">Choose File</label>
      <input type="file" name="banner" id="banner" accept="image/*" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded file:border-0 file:text-sm file:font-semibold file:bg-indigo-50 file:text-indigo-700 hover:file:bg-indigo-100" required>
    </div>
    <!-- cropping contiainer -->
    <div id="cropperContainer2" style="display: none; max-width: 500px; margin-bottom: 20px;">  
      <img id="image2" src="" alt="Image for cropping" style="max-width: 100%;"> 
    </div>
    <!--cropping container-->
    <button type="button" id="cropButton2" style="display: none;" class="bg-blue-500 text-white px-4 py-2 rounded hover:bg-blue-700">Crop & Upload</button>
  </form>
  <h2 class="text-xl font-bold mb-4">Uploaded Banners</h2>
  <div class="grid grid-cols-10 gap-4">
    <% if (banner && banner.length > 0) { %>  
      <% banner.forEach(l => { %>
        <div>
          <img src="<%= l.image.data %>" alt="banner">     
        </div>
      <% }) %>
    <% } else { %>
      <p>No images available</p>
    <% } %> 
  </div>
</div>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script>
<script>
  //logo 
    let cropper;
    const inputImage = document.getElementById('logo'); 
    const image = document.getElementById('image');
    const cropButton = document.getElementById('cropButton');
    const uploadForm = document.getElementById('uploadForm');
    const cropperContainer = document.getElementById('cropperContainer');

    inputImage.addEventListener('change', (event) => {
        const files = event.target.files;
        if (files && files.length > 0) {
            const file = files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                image.src = e.target.result;
                cropperContainer.style.display = 'block';
                cropButton.style.display = 'inline-block';
                if (cropper) {
                    cropper.destroy();
                }
                cropper = new Cropper(image, {
                    aspectRatio: NaN, // Free aspect ratio
                    viewMode: 1,
                    dragMode: 'move',
                    cropBoxMovable: true,
                    cropBoxResizable: true,
                    minCropBoxWidth: 50,
                    minCropBoxHeight: 50,
                });
            };
            reader.readAsDataURL(file);
        }
    });

    cropButton.addEventListener('click', () => {
        if (!cropper) {  
            alert('Please select an image first.');
            return;
        }

        cropper.getCroppedCanvas().toBlob((blob) => {
            const formData = new FormData(uploadForm);
            formData.set('logo', blob, 'cropped.png');

            fetch('/admin/uploadLogo', {
                method: 'POST',
                body: formData,
            }).then(response => {
                if (response.ok) {
                    alert('Upload successful'); 
                    location.reload(); // Reload the page to show the new logo
                } else {
                    alert('Upload failed');
                }
            }).catch(error => {
                console.error('Upload error:', error);
                alert('Upload failed');
            });
        }, 'image/png');
    });

    //banner
    let cropper2;
    const inputBanner = document.getElementById('banner'); 
    const banner = document.getElementById('image2');
    const cropButton2 = document.getElementById('cropButton2');
    const uploadForm2 = document.getElementById('uploadForm2');
    const cropperContainer2 = document.getElementById('cropperContainer2');

    inputBanner.addEventListener('change', (event) => {
        const files = event.target.files;
        if (files && files.length > 0) {
            const file = files[0];
            const reader = new FileReader();
            reader.onload = (e) => {
                banner.src = e.target.result; 
                cropperContainer2.style.display = 'block';
                cropButton2.style.display = 'inline-block';
                if (cropper2) {
                    cropper.destroy();
                }
                cropper2 = new Cropper(image2, {
                    aspectRatio: NaN, // Free aspect ratio
                    viewMode: 1,
                    dragMode: 'move',
                    cropBoxMovable: true,
                    cropBoxResizable: true,
                    minCropBoxWidth: 50,
                    minCropBoxHeight: 50,
                });
            };
            reader.readAsDataURL(file);
        }
    });

    cropButton2.addEventListener('click', () => {
        if (!cropper2) {  
            alert('Please select an image first.');
            return;
        }

        cropper2.getCroppedCanvas().toBlob((blob) => {
            const formData = new FormData(uploadForm2);
            formData.set('banner', blob, 'cropped.png');

            fetch('/admin/uploadBanner', {
                method: 'POST',
                body: formData,
            }).then(response => {
                if (response.ok) {
                    alert('Upload successful'); 
                    location.reload(); // Reload the page to show the new logo
                } else {
                    alert('Upload failed');
                }
            }).catch(error => {
                console.error('Upload error:', error);
                alert('Upload failed');
            });
        }, 'image/png');
    });
</script>